{"ast":null,"code":"import _defineProperty from\"E:\\\\H5\\\\react\\\\taopiaopiao\\\\taopiaopiao_cilent\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";import _classCallCheck from\"E:\\\\H5\\\\react\\\\taopiaopiao\\\\taopiaopiao_cilent\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"E:\\\\H5\\\\react\\\\taopiaopiao\\\\taopiaopiao_cilent\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"E:\\\\H5\\\\react\\\\taopiaopiao\\\\taopiaopiao_cilent\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"E:\\\\H5\\\\react\\\\taopiaopiao\\\\taopiaopiao_cilent\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";import _inherits from\"E:\\\\H5\\\\react\\\\taopiaopiao\\\\taopiaopiao_cilent\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(source,true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(source).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import React from'react';import'./List.css';import{ListView}from'antd-mobile';import $ from'jquery';import IsPurser from'./IsPurser';var dataSource=new ListView.DataSource({rowHasChanged:function rowHasChanged(row1,row2){return row1!==row2;}});var NUM_ROWS=100;function genData(){var pIndex=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var dataBlob={};for(var i=0;i<NUM_ROWS;i++){var ii=pIndex*NUM_ROWS+i;dataBlob[\"\".concat(ii)]=\"row - \".concat(ii);}return dataBlob;}var List=/*#__PURE__*/function(_React$Component){_inherits(List,_React$Component);function List(props){var _this;_classCallCheck(this,List);_this=_possibleConstructorReturn(this,_getPrototypeOf(List).call(this,props));_this.onEndReached=function(event){// load new data\n// hasMore: from backend data, indicates whether it is the last page, here is false\nif(_this.state.isLoading&&!_this.state.hasMore){return;}_this.setState({isLoading:true});setTimeout(function(){_this.rData=_objectSpread({},_this.rData,{},_this.genData(++_this.pageIndex));_this.setState({dataSource:_this.state.dataSource.cloneWithRows(_this.rData),isLoading:false});},1000);};_this.state={homeobj:props.homeobj,dataSource:dataSource,isLoading:true,isShow:props.isShow,NUM_ROWS:40,pageIndex:0,data1:[]};return _this;}_createClass(List,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;var data1=null;$.ajax({url:\"http://localhost:9000/getindex\",type:\"GET\",dataType:\"text\",success:function success(data){if(data){data=JSON.parse(data);data1=data;}},error:function error(){}});setTimeout(function(){_this2.rData=genData();_this2.setState({dataSource:_this2.state.dataSource.cloneWithRows(_this2.rData),isLoading:false,data1:data1});},600);}},{key:\"toDetail\",value:function toDetail(title){this.state.homeobj.props.history.push({pathname:\"/moviedetail\",query:{title:title}});}},{key:\"render\",value:function render(){var _this3=this;if(this.state.data1!=null){//所有的电影列表\nvar movielist=this.state.data1;//已经上映的电影\nvar list1=[];//未上映的电影\nvar list2=[];var year=new Date().getFullYear();var month=new Date().getMonth()+1;var date=new Date().getDate();if(movielist!=null){for(var i=0;i<movielist.length;i++){var movieYear=Number(movielist[i].moviedate.substring(0,4));var movieMonth=Number(movielist[i].moviedate.substring(5,7));var moviedate=Number(movielist[i].moviedate.substring(8,10))+1;if(movieYear>year){list2.push(movielist[i]);}else if(movieYear<year){list1.push(movielist[i]);}else{if(movieMonth>month){list2.push(movielist[i]);}else if(movieMonth<month){list1.push(movielist[i]);}else{if(moviedate>date){list2.push(movielist[i]);}else{list1.push(movielist[i]);}}}}}var data=[];if(this.state.isShow==true){data=list1;}else{data=list2;}}var separator=function separator(sectionID,rowID){return React.createElement(\"div\",{key:\"\".concat(sectionID,\"-\").concat(rowID),style:{backgroundColor:'#F5F5F9',height:8,borderTop:'1px solid #ECECED',borderBottom:'1px solid #ECECED'}});};var index=0;var row=function row(rowData,sectionID,rowID){if(index<=data.length){var _ref;var obj=data[index++];var _date=obj.moviedate.substring(0,10);return React.createElement(\"div\",{key:rowID,style:{padding:'0 15px'},onClick:_this3.toDetail.bind(_this3,obj.movietitle)},React.createElement(\"div\",{style:{lineHeight:'50px',color:'#000',fontSize:18,borderBottom:'1px solid #F6F6F6'}},obj.movietitle),React.createElement(\"div\",{style:(_ref={display:'-webkit-box'},_defineProperty(_ref,\"display\",'flex'),_defineProperty(_ref,\"padding\",'15px 0'),_defineProperty(_ref,\"position\",'relative'),_ref)},React.createElement(\"img\",{style:{height:'100px',marginRight:'15px'},src:obj.movieimage,alt:\"\"}),React.createElement(\"div\",{style:{lineHeight:1}},React.createElement(\"div\",{style:{marginBottom:'15px',marginTop:'5px',fantSize:'13px',color:'#666',width:'auto',overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap'}},\"\\u8BC4\\u5206\\uFF1A\",obj.moviemark),React.createElement(\"div\",{style:_defineProperty({marginBottom:'15px',marginTop:'15px',fantSize:'13px',color:'#666',width:'auto',overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap'},\"width\",'10rem')},\"\\u5BFC\\u6F14\\uFF1A\",obj.moviedirect),React.createElement(\"div\",{style:_defineProperty({marginBottom:'15px',marginTop:'15px',fantSize:'13px',color:'#666',width:'auto',overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap'},\"width\",'10rem')},\"\\u4E3B\\u6F14\\uFF1A\",obj.moviestar),React.createElement(\"div\",{style:_defineProperty({marginBottom:'15px',marginTop:'15px',fantSize:'13px',color:'#666',width:'auto',overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap'},\"width\",'10rem')},\"\\u4E0A\\u6620\\u65F6\\u95F4\\uFF1A\",_date)),React.createElement(IsPurser,{isShow:_this3.props.isShow})));}};return React.createElement(ListView,{ref:function ref(el){return _this3.lv=el;},initialListSize:data.length,dataSource:this.state.dataSource,renderFooter:function renderFooter(){return React.createElement(\"div\",{style:{padding:30,textAlign:'center'}},_this3.state.isLoading?'Loading...':'Loaded');},renderRow:row,renderSeparator:separator,className:\"am-list\",pageSize:40,useBodyScroll:true,onScroll:function onScroll(){console.log('scroll');},scrollRenderAheadDistance:500,onEndReached:this.onEndReached,onEndReachedThreshold:1000});}}]);return List;}(React.Component);export{List as default};","map":{"version":3,"sources":["E:/H5/react/taopiaopiao/taopiaopiao_cilent/src/components/List.js"],"names":["React","ListView","$","IsPurser","dataSource","DataSource","rowHasChanged","row1","row2","NUM_ROWS","genData","pIndex","dataBlob","i","ii","List","props","onEndReached","event","state","isLoading","hasMore","setState","setTimeout","rData","pageIndex","cloneWithRows","homeobj","isShow","data1","ajax","url","type","dataType","success","data","JSON","parse","error","title","history","push","pathname","query","movielist","list1","list2","year","Date","getFullYear","month","getMonth","date","getDate","length","movieYear","Number","moviedate","substring","movieMonth","separator","sectionID","rowID","backgroundColor","height","borderTop","borderBottom","index","row","rowData","obj","padding","toDetail","bind","movietitle","lineHeight","color","fontSize","display","marginRight","movieimage","marginBottom","marginTop","fantSize","width","overflow","textOverflow","whiteSpace","moviemark","moviedirect","moviestar","el","lv","textAlign","console","log","Component"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport './List.css'\r\nimport { ListView } from 'antd-mobile';\r\nimport $ from 'jquery';\r\nimport IsPurser from './IsPurser';\r\nconst dataSource = new ListView.DataSource({\r\n    rowHasChanged: (row1, row2) => row1 !== row2,\r\n});\r\nconst NUM_ROWS = 100;\r\nfunction genData(pIndex = 0) {\r\n    const dataBlob = {};\r\n    for (let i = 0; i < NUM_ROWS; i++) {\r\n        const ii = (pIndex * NUM_ROWS) + i;\r\n        dataBlob[`${ii}`] = `row - ${ii}`;\r\n    }\r\n    return dataBlob;\r\n}\r\n\r\nexport default class List extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            homeobj:props.homeobj,\r\n            dataSource,\r\n            isLoading: true,\r\n            isShow: props.isShow,\r\n            NUM_ROWS: 40,\r\n            pageIndex: 0,\r\n            data1: [],\r\n        };\r\n    }\r\n    componentDidMount() {\r\n\r\n        let data1=null;\r\n        $.ajax({\r\n            url: \"http://localhost:9000/getindex\",\r\n            type: \"GET\",\r\n            dataType: \"text\",\r\n            success(data) {\r\n                if (data) {\r\n                    data = JSON.parse(data);\r\n                    data1=data;\r\n                  \r\n                }\r\n            },\r\n            error() {\r\n  \r\n            }\r\n        });\r\n        setTimeout(()=> {\r\n            this.rData = genData();\r\n            this.setState({\r\n                dataSource: this.state.dataSource.cloneWithRows(this.rData),\r\n                isLoading: false,\r\n                data1:data1\r\n            });\r\n        }, 600);\r\n    }\r\n    \r\n    onEndReached = (event) => {\r\n        // load new data\r\n        // hasMore: from backend data, indicates whether it is the last page, here is false\r\n\r\n        if (this.state.isLoading && !this.state.hasMore) {\r\n            return;\r\n        }\r\n\r\n        this.setState({ isLoading: true });\r\n        setTimeout(() => {\r\n            this.rData = { ...this.rData, ...this.genData(++this.pageIndex) };\r\n            this.setState({\r\n                dataSource: this.state.dataSource.cloneWithRows(this.rData),\r\n                isLoading: false,\r\n            });\r\n        }, 1000);\r\n    }\r\n    toDetail(title){\r\n        this.state.homeobj.props.history.push({\r\n            pathname:\"/moviedetail\",\r\n            query:{\r\n                title:title\r\n            }\r\n        })\r\n    }\r\n    render() {\r\n        if (this.state.data1 != null) {\r\n            //所有的电影列表\r\n            let movielist = this.state.data1;\r\n            //已经上映的电影\r\n            let list1 = [];\r\n            //未上映的电影\r\n            let list2 = [];\r\n            let year = new Date().getFullYear();\r\n            let month = new Date().getMonth() + 1;\r\n            let date = new Date().getDate();\r\n            if (movielist != null) {\r\n                for (let i = 0; i < movielist.length; i++) {\r\n                    let movieYear = Number(movielist[i].moviedate.substring(0, 4));\r\n                    let movieMonth = Number(movielist[i].moviedate.substring(5, 7));\r\n                    let moviedate = Number(movielist[i].moviedate.substring(8, 10)) + 1;\r\n                    if (movieYear > year) {\r\n                        list2.push(movielist[i]);\r\n                    }\r\n                    else if (movieYear < year) {\r\n                        list1.push(movielist[i]);\r\n                    }\r\n                    else {\r\n                        if (movieMonth > month) {\r\n                            list2.push(movielist[i]);\r\n                        }\r\n                        else if (movieMonth < month) {\r\n                            list1.push(movielist[i]);\r\n                        }\r\n                        else {\r\n                            if (moviedate > date) {\r\n                                list2.push(movielist[i]);\r\n                            }\r\n                            else {\r\n                                list1.push(movielist[i]);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            var data=[];\r\n            if (this.state.isShow == true) {\r\n                data=list1;\r\n    \r\n            }\r\n            else {\r\n                data=list2;\r\n     \r\n            }\r\n        }\r\n        const separator = (sectionID, rowID) => (\r\n            <div\r\n                key={`${sectionID}-${rowID}`}\r\n                style={{\r\n                    backgroundColor: '#F5F5F9',\r\n                    height: 8,\r\n                    borderTop: '1px solid #ECECED',\r\n                    borderBottom: '1px solid #ECECED',\r\n                }}\r\n            />\r\n        );\r\n        let index = 0;\r\n        const row = (rowData, sectionID, rowID) => {\r\n            if (index <= data.length) {\r\n                const obj = data[index++];\r\n                let date= obj.moviedate.substring(0,10)\r\n                return (\r\n                    <div key={rowID} style={{ padding: '0 15px' }} onClick={this.toDetail.bind(this,obj.movietitle)}>\r\n                        <div\r\n                            style={{\r\n                                lineHeight: '50px',\r\n                                color: '#000',\r\n                                fontSize: 18,\r\n                                borderBottom: '1px solid #F6F6F6',\r\n                            }}\r\n                        >{obj.movietitle}</div>\r\n                        <div style={{ display: '-webkit-box', display: 'flex', padding: '15px 0', position: 'relative' }}>\r\n                            <img style={{ height: '100px', marginRight: '15px' }} src={obj.movieimage} alt=\"\" />\r\n                            <div style={{ lineHeight: 1 }}>\r\n                                <div style={{ marginBottom: '15px', marginTop: '5px', fantSize: '13px', color: '#666', width: 'auto', overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>评分：{obj.moviemark}</div>\r\n                                <div style={{ marginBottom: '15px', marginTop: '15px', fantSize: '13px', color: '#666', width: 'auto', overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap',width:'10rem' }}>导演：{obj.moviedirect}</div>\r\n                                <div style={{ marginBottom: '15px', marginTop: '15px', fantSize: '13px', color: '#666', width: 'auto', overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap',width:'10rem' }}>主演：{obj.moviestar}</div>\r\n                                <div style={{ marginBottom: '15px', marginTop: '15px', fantSize: '13px', color: '#666', width: 'auto', overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap',width:'10rem' }}>上映时间：{date}</div>\r\n                            </div>\r\n\r\n                            <IsPurser isShow={this.props.isShow}></IsPurser>\r\n                        </div>\r\n                    </div>\r\n                );\r\n            }\r\n        };\r\n        return (\r\n            <ListView\r\n                ref={el => this.lv = el}\r\n                initialListSize={data.length}\r\n                dataSource={this.state.dataSource}\r\n                renderFooter={() => (<div style={{ padding: 30, textAlign: 'center' }}>\r\n                    {this.state.isLoading ? 'Loading...' : 'Loaded'}\r\n                </div>)}\r\n                renderRow={row}\r\n                renderSeparator={separator}\r\n                className=\"am-list\"\r\n                pageSize={40}\r\n                useBodyScroll\r\n                onScroll={() => { console.log('scroll'); }}\r\n                scrollRenderAheadDistance={500}\r\n                onEndReached={this.onEndReached}\r\n                onEndReachedThreshold={1000}\r\n            />\r\n        );\r\n    }\r\n}\r\n\r\n"]},"metadata":{},"sourceType":"module"}